<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="description" content="Thesis project: Making data accesible: An overview of interac-tive data visualization using D3.js as applied to scientific datasets">
        <meta name="keywords" content="HTML,CSS,JSON,JavaScript">
        <meta name="author" content="Laura Meskanen-Kundu">
        <title>D3 Test</title>
        <script type="text/javascript" src="js/d3.min.v3.5.5.js"></script>
        <script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <!-- Optional theme -->
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
        <!-- Latest compiled and minified JavaScript -->
        <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/main.css">
    </head>
    <body>
        <!-- Page elements where data goes -->
        <div></div>
        <span></span>

        <script type="text/javascript">
            var margin = {top: 10, right: 50, bottom: 50, left: 50},
                width = window.innerWidth-100,
                height = window.innerHeight-60,
                centered;

            var x = d3.scale.linear()
                .domain([0, width])
                .range([width, 0]);

            var y = d3.scale.linear()
                .domain([height, 0])
                .range([height, 0]);

            //coloring the different lines
            var color = d3.scale.category10();

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left");

            var line = d3.svg.line()
                .interpolate("basis")
                .x(function(d) { return x(d.countTime); })
                .y(function(d) { return y(d.temperature); });

            var svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                /* annimating variables:
                var random = d3.random.normal(0, width);

                var zoom = d3.behavior.zoom()
                    .x(x)
                    .y(y)
                    .size([width, height])
                    .on("zoom", zoomed);

                var k = 80;

                //end of annimation variables*/

            //load external data:
            d3.json("json/3milYears_temp.json", function(error, json) {
                if (error!=null) return console.warn(error);
                visualizeit(json).on("click", clicked());
            });

            /* Visualizing the data */
            function visualizeit(data){
                color.domain(d3.keys(data[0]).filter(function(key){
                    return key !== "countTime" & key!=="rsl";
                }));

                var temperatures = color.domain().map(function(nameOf){
                    return {
                            nameOf: nameOf,
                            values: data.map(function(d){
                                return {countTime: d.countTime, temperature: +d[nameOf]};
                            })
                    };
                });

                x.domain(d3.extent(data, function(d) { return d.countTime; }));

                y.domain([
                    d3.min(temperatures, function(c) { return d3.min(c.values, function(v) { return v.temperature; }); }),
                    d3.max(temperatures, function(c) { return d3.max(c.values, function(v) { return v.temperature; }); })
                    ]);

                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);

                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Temperature delta T");

                var difTemp = svg.selectAll(".temp")
                    .data(temperatures)
                    .enter().append("g")
                    .attr("class", "temp");

                difTemp.append("path")
                    .attr("class", "line")
                    .attr("d", function(d) { return line(d.values); })
                    .style("stroke", function(d) { return color(d.nameOf); });

/*There is some problem here that i can not figure out:
                difTemp.append("text")
                    .datum(function(d) {console.log({lastData: d.values[d.values.length-1]}); 
                        return {nameOf: name, lastData: d.values[d.values.length-1]}})
                    .attr("transform", function(d) { console.log(x(d.lastData.countTime) + "," + y(d.lastData.temperature));
                        return "translate(" + x(d.lastData.countTime) + "," + y(d.lastData.temperature) + ")"; })
                    .attr("x",3)
                    .attr("y", ".35em")
                    .text(function(d) { return d.nameOf; });
//example piece of code:
                /*difTemp.append("text")
                    .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
                    .attr("transform", function(d) { return "translate(" + x(d.value.date) + "," + y(d.value.temperature) + ")"; })
                    .attr("x", 3)
                    .attr("dy", ".35em")
                .text(function(d) { return d.name; });*/
            };

            function clicked(d) {
                console.log("clicked");
                var x, y, k;
                if (d && centered !== d) {
                var centroid = svg.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 4;
                centered = d;
                } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
                }

                $('svg').transition()
                  .duration(750)
                  .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                  .style("stroke-width", 1.5 / k + "px");
            }

            /* Annimating the data */
            /* create the zoom listener
            var zoomListener = d3.behavior.zoom()
              .scaleExtent([0.1, 3])
              .on("zoom", zoomHandler);

            // function for handling zoom event
            function zoomHandler() {
              vis.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
            }

            // create the svg
            rootSvg = d3.select("#tree-body").append("svg:svg");
            /*
              creating your svg image here
            

            // apply the zoom behavior to the svg image
            zoomListener(rootSvg);*/

            /* animating the dataset 
            var context = svg;
            svg.call(zoom.event);
            jump();

            function zoomed() {
                //context.fillRect(0, 0, width, height);
                context.lineWidth = 4 * zoom.scale();
                for (var d = x.domain(),
                    x0 = Math.floor(d[0] / k) * k,
                    x1 = Math.ceil(d[1] / k) * k; x0 <= x1; x0 += k) {
                        context.createElementNS(svgns, "path");
                        context.setAttributeNS(M(x0) 0);
                        context.setAttributeNS(Lx0 height);
                    }
                for (var d = y.domain(),
                y0 = Math.floor(d[0] / k) * k,
                y1 = Math.ceil(d[1] / k) * k; y0 <= y1; y0 += k) {
                    context.beginPath();
                    context.moveTo(0, y(y0));
                    context.lineTo(width, y(y0));
                    context.stroke();
                }
            }

            function jump() {
                svg.transition()
                .duration(5000)
                .call(zoom.translate([random(), random()]).event)
                .each("end", jump);
            }
            */
        </script>
    </body>
</html> 